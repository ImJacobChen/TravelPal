!function(){"use strict";var a={travellingFrom:{isSelected:!1,stationName:"",stationId:""},travellingTo:{isSelected:!1,stationName:"",stationId:""}};document.getElementById("form").addEventListener("submit",function(b){b.preventDefault(),0!=a.checkIfStationsSelected()&&a.getJourneyDetails()});for(var b=document.querySelectorAll(".input-field"),c=function(){var b=this.parentNode,c=b.querySelectorAll(".suggestions")[0],d=this,f=this.value,g=this.getAttribute("id");if(a[g].isSelected&&e.resetInputDefault(b),a.clearSelectedStation(g),!f||""==f)return void e.clearSuggestionBox(c);var h="https://api.tfl.gov.uk/Stoppoint/search/"+f+"?modes=tube&maxResults=15";$.get(h,function(a){var b=document.createElement("li");b.innerHTML="Loading",c.appendChild(b)}).done(function(e){for(;c.firstChild;)c.removeChild(c.firstChild);e.matches.forEach(function(e){var f=document.createElement("li");f.innerHTML=e.name,f.addEventListener("click",function(){a._onSuggestionClick(e.name,e.icsId,d,c,b)}),c.appendChild(f)})})},d=0;d<b.length;d++)b[d].addEventListener("input",c,!1);a.clearSelectedStation=function(b){a[b].isSelected=!1,a[b].stationName="",a[b].stationId=""},a._onSuggestionClick=function(b,c,d,f,g){var h=d.getAttribute("id");for(d.value=b;f.firstChild;)f.removeChild(f.firstChild);a[h].isSelected=!0,a[h].stationName=b,a[h].stationId=c,e.stationSelected(g,b)},a.checkIfStationsSelected=function(){var b=!0;return a.travellingFrom.isSelected||(e.noStationSelected(document.getElementById("fromFormGroup")),b=!1),a.travellingTo.isSelected||(e.noStationSelected(document.getElementById("toFormGroup")),b=!1),b},a.getJourneyDetails=function(){var b="https://api.tfl.gov.uk/Journey/JourneyResults/"+a.travellingFrom.stationId+"/to/"+a.travellingTo.stationId+"?nationalSearch=False&timeIs=Departing&journeyPreference=LeastTime&mode=tube&walkingSpeed=Average&cyclePreference=None&alternativeCycle=False&alternativeWalking=True&applyHtmlMarkup=False&useMultiModalCall=False&walkingOptimization=False&app_id=&app_key=";$.get(b,function(a){}).done(function(b){console.log(b),a.generateJourneysHtml(a.travellingFrom.stationName,a.travellingTo.stationName,b.journeys),journeyDB.addJourney(b,a.travellingFrom.stationName,a.travellingTo.stationName,a.refreshRecentJourneys)}).fail(function(){notie.alert(2,"Could not complete request. Please Retry",3.5)})},a.generateJourneysHtml=function(a,b,c){var d=document.getElementById("journeys");d.innerHTML="";var e=1;c.forEach(function(f){var g=document.createElement("div");g.className="journey";var h=document.createElement("div");h.className="journeyTitle";var i=document.createElement("h3");i.innerHTML=a+" to "+b;var j=document.createElement("h3");j.className="subheading muted",j.innerHTML="Option ["+e+"/"+c.length+"]",h.appendChild(i),h.appendChild(j),g.appendChild(h);var k=document.createElement("div");k.className="row";var l=document.createElement("div");l.className="col-xs-4";var m=f.startDateTime.split("T",2);l.innerHTML="Start Time <br> "+m[1];var n=document.createElement("div");n.className="col-xs-4";var o=f.arrivalDateTime.split("T",2);n.innerHTML="Arrival Time <br>"+o[1];var p=document.createElement("div");p.className="col-xs-4",p.innerHTML="Duration <br>"+f.duration+" minutes",k.appendChild(l),k.appendChild(n),k.appendChild(p),g.appendChild(k),f.legs.forEach(function(a){var b=document.createElement("div");b.className="journeyLeg";var c=document.createElement("div"),d=a.departureTime.split("T",2);c.innerHTML="<b>"+a.departurePoint.commonName+"</b> <br> Depart - "+d[1];var e=document.createElement("div");e.className="journeyLegArrow",e.innerHTML='<img src="images/Forward_Arrow.png">';var f=document.createElement("div"),h=a.arrivalTime.split("T",2);f.innerHTML="<b>"+a.arrivalPoint.commonName+"</b> <br> Arrive - "+h[1],b.appendChild(c),b.appendChild(e),b.appendChild(f),g.appendChild(b)}),e++,d.appendChild(g)})},a.refreshRecentJourneys=function(){journeyDB.fetchRecentJourneys(function(b){var c=document.getElementById("recentJourneys_ul");c.innerHTML="";for(var d=0;d<b.length;d++){var e=b[b.length-1-d],f=document.createElement("li");f.setAttribute("data-id",e.timestamp);var g=document.createElement("span"),h=document.createElement("a");h.innerHTML=e.title,h.setAttribute("data-id",e.timestamp),g.appendChild(h),f.appendChild(g),c.appendChild(f),f.addEventListener("click",function(b){var c=parseInt(b.target.getAttribute("data-id")),d=journeyDB.getJourney(c);d.onsuccess=function(b){var c=b.target.result;a.generateJourneysHtml(c.from,c.to,c.journey.journeys)},d.onerror=function(a){console.log(a)}})}})};var e={clearSuggestionBox:function(a){a.innerHTML=""},resetInputDefault:function(a){var b=a.querySelectorAll(".help-block")[0];a.classList.contains("has-success")&&a.classList.remove("has-success"),a.classList.contains("has-error")&&a.classList.remove("has-error"),b.innerHTML=b.getAttribute("data-defaultText")},noStationSelected:function(a){var b=a.querySelectorAll(".help-block")[0];a.classList.contains("has-success")&&a.classList.remove("has-success"),a.classList.add("has-error"),b.innerHTML="Please select a station from the dropdown list."},stationSelected:function(a,b){var c=a.querySelectorAll(".help-block")[0];a.classList.contains("has-error")&&a.classList.remove("has-error"),a.classList.add("has-success"),c.innerHTML="Excellent. You selected: <b>"+b+"</b>"}};"serviceWorker"in navigator&&navigator.serviceWorker.register("/service-worker.js").then(function(){console.log("Service Worker Registered")}),journeyDB.open(a.refreshRecentJourneys)}();